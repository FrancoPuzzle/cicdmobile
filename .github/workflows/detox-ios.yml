name: iOS

on: [push]

jobs:
  build:
    runs-on: macos-latest
    env:
      STAGING_API_URL: 'https://rickandmortyapi.com/graphql'
      PRODUCTION_API_URL: ''
      IS_STORYBOOK: false
      SENTRY_DSN: ''
      SEGMENT_DSN: ''

    steps:
      - name: Checkout
        uses: actions/checkout@v1
        with:
          fetch-depth: 1

      - name: Install Node
        uses: actions/setup-node@v1
        with:
          node-version: '12'

      - name: Install Yarn Dependencies
        run: yarn install

      - name: Install Pod Dependencies
        run: cd ./ios && pod install && cd ..

      - name: Install Detox Dependencies
        run: |
          brew tap wix/brew
          brew install applesimutils

      - name: Run Detox Build
        run: yarn detox build e2e --configuration ios.sim.release

      - name: Run Detox Test(s)
        run: yarn detox test e2e --configuration ios.sim.release --cleanup --debug-synchronization 200
